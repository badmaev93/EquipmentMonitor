<Window x:Class="EquipmentMonitor.Views.LoginWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Вход — Панель мониторинга"
        Height="520" Width="820"
        WindowStartupLocation="CenterScreen"
        ResizeMode="NoResize"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        Icon="/icon.ico"
        MouseLeftButtonDown="Window_MouseLeftButtonDown">

    <Window.Resources>
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#333"/>
            <Style.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="8"/>
                </Style>
            </Style.Resources>
        </Style>

        <Style x:Key="ModernPasswordBox" TargetType="PasswordBox">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#333"/>
            <Style.Resources>
                <Style TargetType="Border">
                    <Setter Property="CornerRadius" Value="8"/>
                </Style>
            </Style.Resources>
        </Style>

        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#1A73C7"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="0,14"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                CornerRadius="10" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#1565B8"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#0D5299"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="border" Property="Background" Value="#B0C4DE"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryButton" TargetType="Button">
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#1A73C7"/>
            <Setter Property="BorderBrush" Value="#1A73C7"/>
            <Setter Property="BorderThickness" Value="1.5"/>
            <Setter Property="Padding" Value="0,14"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#F0F6FF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#E0EEFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LinkButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#1A73C7"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <TextBlock x:Name="txt" Text="{TemplateBinding Content}"
                                   Foreground="{TemplateBinding Foreground}"
                                   FontSize="{TemplateBinding FontSize}"
                                   HorizontalAlignment="Center"/>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="txt" Property="TextDecorations" Value="Underline"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border CornerRadius="16" Background="White">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.15" Color="#000"/>
        </Border.Effect>

        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="380"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Левая панель — брендинг -->
            <Border Grid.Column="0" CornerRadius="16,0,0,16"
                    Background="White">
                <Grid Margin="30">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Логотип -->
                    <Image Grid.Row="0" Source="/icon.png" Width="64" Height="64"
                           HorizontalAlignment="Left" Margin="0,20,0,0"
                           RenderOptions.BitmapScalingMode="HighQuality"/>

                    <!-- Описание -->
                    <StackPanel Grid.Row="1" VerticalAlignment="Center">
                        <TextBlock Text="Прозрачный учет" FontSize="22" FontWeight="Bold"
                                   Foreground="#1A1A2E" Margin="0,0,0,2"/>
                        <TextBlock Text="IT-инфраструктуры" FontSize="22" FontWeight="Bold"
                                   Foreground="#1A1A2E" Margin="0,0,0,16"/>
                        <TextBlock TextWrapping="Wrap" Foreground="#6B7280" FontSize="13" LineHeight="20">
                            Панель мониторинга для сбора, обработки и структурирования информации об оборудовании для помощи в оптимизации затрат и планирования закупок
                        </TextBlock>
                    </StackPanel>

                    <!-- Контакт -->
                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                        <Image Source="/icons8-telegram-app-48.png" Width="28" Height="28"
                               RenderOptions.BitmapScalingMode="HighQuality"/>
                        <TextBlock Text="@orllg" Foreground="#6B7280" FontSize="13"
                                   VerticalAlignment="Center" Margin="8,0,0,0"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Правая панель — логин или 2FA -->
            <Border Grid.Column="1" CornerRadius="0,16,16,0"
                    Background="#FAFBFC">
                <Grid>

                    <!-- Панель логина -->
                    <StackPanel x:Name="LoginPanel" VerticalAlignment="Center" Margin="40,0,40,0">
                        <TextBlock Text="Вход в систему" FontSize="22" FontWeight="Bold"
                                   Foreground="#1A1A2E" HorizontalAlignment="Center" Margin="0,0,0,32"/>

                        <StackPanel Margin="0,0,0,12">
                            <TextBlock Text="Логин" Foreground="#6B7280" FontSize="13" Margin="4,0,0,4"/>
                            <TextBox x:Name="UsernameBox" Style="{StaticResource ModernTextBox}" Tag="Логин"/>
                        </StackPanel>

                        <StackPanel Margin="0,0,0,20">
                            <TextBlock Text="Пароль" Foreground="#6B7280" FontSize="13" Margin="4,0,0,4"/>
                            <Grid>
                                <PasswordBox x:Name="PasswordBox" Style="{StaticResource ModernPasswordBox}"/>
                                <TextBox x:Name="PasswordTextBox" Style="{StaticResource ModernTextBox}"
                                         Visibility="Collapsed"
                                         TextChanged="PasswordTextBox_TextChanged"/>
                                <Button x:Name="TogglePasswordButton"
                                        HorizontalAlignment="Right" VerticalAlignment="Center"
                                        Margin="0,0,8,0" Width="30" Height="30"
                                        Background="Transparent" BorderThickness="0"
                                        Cursor="Hand"
                                        Click="TogglePasswordVisibility_Click">
                                    <Button.Template>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="bg" Background="Transparent" CornerRadius="4"
                                                    Width="30" Height="30">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="bg" Property="Background" Value="#F0F0F0"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Button.Template>
                                    <Grid Width="18" Height="18">
                                        <!-- Open eye (shown when password hidden = click to reveal) -->
                                        <Viewbox x:Name="EyeOpen" Visibility="Collapsed">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M12,4.5 C7,4.5 2.73,7.61 1,12 C2.73,16.39 7,19.5 12,19.5 C17,19.5 21.27,16.39 23,12 C21.27,7.61 17,4.5 12,4.5 Z M12,17 C9.24,17 7,14.76 7,12 C7,9.24 9.24,7 12,7 C14.76,7 17,9.24 17,12 C17,14.76 14.76,17 12,17 Z M12,9 C10.34,9 9,10.34 9,12 C9,13.66 10.34,15 12,15 C13.66,15 15,13.66 15,12 C15,10.34 13.66,9 12,9 Z"
                                                      Fill="#999"/>
                                            </Canvas>
                                        </Viewbox>
                                        <!-- Closed eye with slash (shown when password hidden by default) -->
                                        <Viewbox x:Name="EyeClosed">
                                            <Canvas Width="24" Height="24">
                                                <Path Data="M12,7 C14.76,7 17,9.24 17,12 C17,12.65 16.87,13.26 16.64,13.83 L19.56,16.75 C21.07,15.49 22.26,13.86 23,12 C21.27,7.61 17,4.5 12,4.5 C10.6,4.5 9.26,4.75 8,5.2 L10.17,7.36 C10.74,7.13 11.35,7 12,7 Z M2,4.27 L4.28,6.55 L4.74,7.01 C3.08,8.3 1.78,10.02 1,12 C2.73,16.39 7,19.5 12,19.5 C13.55,19.5 15.03,19.2 16.38,18.66 L16.8,19.08 L19.73,22 L21,20.73 L3.27,3 L2,4.27 Z M7.53,9.8 L9.08,11.35 C9.03,11.56 9,11.78 9,12 C9,13.66 10.34,15 12,15 C12.22,15 12.44,14.97 12.65,14.92 L14.2,16.47 C13.53,16.8 12.79,17 12,17 C9.24,17 7,14.76 7,12 C7,11.21 7.2,10.47 7.53,9.8 Z M11.84,9.02 L14.99,12.17 L15.01,12.01 C15.01,10.35 13.67,9.01 12.01,9.01 L11.84,9.02 Z"
                                                      Fill="#999"/>
                                            </Canvas>
                                        </Viewbox>
                                    </Grid>
                                </Button>
                            </Grid>
                        </StackPanel>

                        <CheckBox x:Name="RememberCheck" Content="Запомнить вход"
                                  Foreground="#6B7280" FontSize="13" Margin="4,0,0,24"/>

                        <TextBlock x:Name="LoginErrorText" Foreground="#E53E3E"
                                   TextWrapping="Wrap" FontSize="12" Margin="0,0,0,12"
                                   TextAlignment="Center" Visibility="Collapsed"/>

                        <Button x:Name="LoginButton" Content="Войти"
                                Style="{StaticResource PrimaryButton}"
                                Click="LoginButton_Click" IsDefault="True" Margin="0,0,0,10"/>
                        <Button x:Name="DemoButton" Content="Демо"
                                Style="{StaticResource SecondaryButton}"
                                Click="DemoButton_Click" Margin="0,0,0,0"/>
                    </StackPanel>

                    <!-- Индикатор загрузки -->
                    <StackPanel x:Name="LoadingPanel" VerticalAlignment="Center" HorizontalAlignment="Center"
                                Visibility="Collapsed">
                        <TextBlock Text="&#xE117;" FontFamily="Segoe MDL2 Assets" FontSize="28"
                                   Foreground="#1A73C7" HorizontalAlignment="Center" Margin="0,0,0,12">
                            <TextBlock.RenderTransform>
                                <RotateTransform x:Name="SpinnerRotation" CenterX="14" CenterY="14"/>
                            </TextBlock.RenderTransform>
                            <TextBlock.Triggers>
                                <EventTrigger RoutedEvent="FrameworkElement.Loaded">
                                    <BeginStoryboard>
                                        <Storyboard RepeatBehavior="Forever">
                                            <DoubleAnimation
                                                Storyboard.TargetName="SpinnerRotation"
                                                Storyboard.TargetProperty="Angle"
                                                From="0" To="360" Duration="0:0:1"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </TextBlock.Triggers>
                        </TextBlock>
                        <TextBlock x:Name="LoadingText" Text="Подключение к серверу..."
                                   Foreground="#6B7280" FontSize="13" HorizontalAlignment="Center"/>
                    </StackPanel>

                    <!-- Диагностика подключения -->
                    <StackPanel x:Name="DiagPanel" VerticalAlignment="Center" Margin="40,0,40,0"
                                Visibility="Collapsed">
                        <TextBlock Text="&#xE783;" FontFamily="Segoe MDL2 Assets" FontSize="36"
                                   Foreground="#E53E3E" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                        <TextBlock Text="Не удалось подключиться" FontSize="18" FontWeight="Bold"
                                   Foreground="#1A1A2E" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                        <TextBlock x:Name="DiagDetailsText" TextWrapping="Wrap" Foreground="#6B7280"
                                   FontSize="12.5" TextAlignment="Center" Margin="0,0,0,8" LineHeight="18"/>
                        <Border Background="#FFF5F5" CornerRadius="8" Padding="12" Margin="0,0,0,20">
                            <StackPanel>
                                <TextBlock Text="Возможные причины:" FontWeight="SemiBold"
                                           Foreground="#C53030" FontSize="12" Margin="0,0,0,6"/>
                                <TextBlock x:Name="DiagReasonsText" TextWrapping="Wrap"
                                           Foreground="#742A2A" FontSize="11.5" LineHeight="17"/>
                            </StackPanel>
                        </Border>
                        <Button Content="Повторить" Style="{StaticResource PrimaryButton}"
                                Click="RetryConnectionButton_Click" Margin="0,0,0,10"/>
                        <Button Content="Войти в демо-режиме" Style="{StaticResource SecondaryButton}"
                                Click="DemoButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Кнопка закрытия (поверх всего, правый верхний угол) -->
            <Button Grid.ColumnSpan="2"
                    Content="&#xE711;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                    HorizontalAlignment="Right" VerticalAlignment="Top"
                    Margin="0,6,6,0" Width="32" Height="32"
                    Background="Transparent" BorderThickness="0"
                    Foreground="#999" Cursor="Hand"
                    Click="CloseButton_Click">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bg" Background="Transparent" CornerRadius="6"
                                Width="32" Height="32">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bg" Property="Background" Value="#F0F0F0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Button.Template>
            </Button>
        </Grid>
    </Border>
</Window>

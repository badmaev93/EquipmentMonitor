# EquipmentMonitor v1.0.0

Панель мониторинга оборудования — готовый к работе билд.

## Запуск

```
EquipmentMonitor.exe
```

- Приложение самодостаточное (self-contained) — .NET Runtime **не требуется**
- Windows 10/11 x64

## Файлы

| Файл | Описание |
|------|----------|
| `EquipmentMonitor.exe` | Приложение (single-file, ~162 МБ) |
| `sample_devices.json` | Пример данных для импорта (15 устройств) |
| `devices.json` | Локальное хранилище данных (создаётся при работе) |
| `settings.json` | Настройки отображения (создаётся при работе) |

## Загрузка тестовых данных

Файл → Импорт → Из JSON → выбрать `sample_devices.json`

## Подключение к БД

При запуске приложение подключается к PostgreSQL (Neon Cloud).
Хост сервера зашит в приложение. Логин и пароль вводятся пользователем.

## Демо-режим

Для работы без подключения к БД нажмите **Демо** на экране входа.


----------------


# Подробное описание исходного кода


## Стек

| Компонент | Технология |
|-----------|-----------|
| Платформа | .NET 8.0 (Windows) |
| UI-фреймворк | WPF |
| Архитектура | MVVM (без логики в code-behind) |
| Хранение данных | JSON (основное), SQLite, Excel (XLSX), PostgreSQL |
| Зависимости | EPPlus 7.5.2, Microsoft.Data.Sqlite 8.0.11, Npgsql 8.0.5 |

## Архитектура

```
EquipmentMonitor/
├── Models/              Модели данных
│   ├── Device.cs            Модель устройства (INotifyPropertyChanged)
│   ├── UserSession.cs       Сессия пользователя
│   └── ViewSettings.cs      Настройки отображения
├── ViewModels/          Логика представлений
│   ├── MainViewModel.cs     Основная ViewModel (фильтрация, CRUD, импорт/экспорт, печать)
│   ├── AddDeviceViewModel.cs  ViewModel диалога добавления
│   └── Base/
│       ├── ViewModelBase.cs     Абстрактный базовый класс (INotifyPropertyChanged)
│       └── RelayCommand.cs      Реализация ICommand
├── Views/               Окна и представления (XAML)
│   ├── MainWindow           Главное окно (двухпанельный интерфейс)
│   ├── LoginWindow          Экран входа / демо-режим
│   ├── AddDeviceWindow      Диалог добавления устройства
│   └── DuplicateResolveWindow  Разрешение конфликтов при импорте
├── Services/            Сервисы данных
│   ├── JsonPersistenceService   Чтение/запись JSON (devices.json, settings.json)
│   ├── ExcelService             Импорт/экспорт Excel (XLSX) через EPPlus
│   ├── DatabaseService          Импорт/экспорт SQLite
│   ├── PostgresDataService      ETL-операции (Pull/Commit/Push) через PostgreSQL
│   ├── AuthService              Аутентификация через PostgreSQL
│   ├── CredentialStore          Хранение учётных данных (Windows DPAPI)
│   └── DialogService            UI-диалоги (подтверждения, выбор файлов)
├── Converters/          Конвертеры значений для XAML-привязок
│   ├── EnumDisplayConverter         Enum → русское название
│   ├── NullToVisibilityConverter    null → Collapsed / Visible
│   └── CategoryToIconConverter      DeviceCategory → иконка Segoe MDL2
└── App.xaml.cs          Точка входа: русская локаль, DI, жизненный цикл
```

### Паттерн MVVM

Паттерн соблюдён строго:

- **Привязка свойств** через `INotifyPropertyChanged` (базовый `ViewModelBase` и модель `Device`)
- **Команды** через `ICommand` / `RelayCommand` с поддержкой `CanExecute`
- **Коллекции** через `ObservableCollection<Device>` — автоматическое обновление UI
- **Фильтрация и группировка** через `CollectionViewSource` с `Filter`, `GroupDescriptions`, `SortDescriptions`
- **Code-behind** содержит только:
  - Проброс `SelectionChanged` для множественного выделения
  - Сортировку по заголовкам столбцов в GridView
  - Копирование JSON в буфер обмена по правому клику

### Поток данных

```
[Views (XAML)] ──Binding──► [ViewModels] ──► [Services] ──► [Хранилища]
                                │                              │
                   RelayCommand / ICommand          JSON / SQLite / XLSX / PostgreSQL
```

Все зависимости (сервисы) инжектируются через конструктор `MainViewModel`.

## Функциональность

### Управление устройствами
- Добавление через диалоговое окно (категория, название, серийный номер, дата установки, статус)
- Редактирование параметров с кнопкой «Сохранить» и предупреждением о несохранённых изменениях
- Удаление с подтверждением

### Категории и статусы
- **Категории:** Серверы, Принтеры, Компьютеры
- **Статусы:** Работает, Сломано, Списано

### Поиск и фильтрация
- Поиск по названию и серийному номеру (регистронезависимый, в реальном времени)
- Фильтрация по статусу, категории, диапазону дат установки
- Кнопка «Сбросить» для очистки всех фильтров

### Режимы отображения (меню «Вид»)
- **Список** — детальный вид с серийным номером и датой
- **Значки** — плитки с иконкой и кратким описанием
- **Колонки** — табличный вид (GridView) с заголовками столбцов и сортировкой по клику

### Сортировка и группировка
- Сортировка/группировка: по категории, по дате установки, по названию, по статусу
- Переключатель «Использовать группы» — при включении элементы группируются, при выключении — сортируются

### Множественное выделение
- Выбор нескольких устройств через Ctrl+Click / Shift+Click
- Экспорт «только выбранных» в любой формат

### Импорт / Экспорт
- **Форматы:** JSON, Excel (XLSX), SQLite
- При импорте данные **добавляются** к существующим (не перезаписывают)
- При совпадении серийного номера — диалог: **Перезаписать / Оставить оба / Не добавлять** с галочкой «Применить для всех»
- JSON экспортируется в UTF-8 с корректной кириллицей

### База данных (PostgreSQL)
- **Pull** — загрузка устройств из ODS
- **Commit** — сохранение в staging + трансформация в ODS
- **Push** — полный ETL-цикл через хранимые процедуры

### Печать
- Печать списка устройств с текущими фильтрами и группировкой
- Три формата печати соответствуют трём режимам отображения
- Пагинация с нумерацией страниц

### Аутентификация
- Вход через учётные данные PostgreSQL
- Сохранение логина (Windows DPAPI)
- Демо-режим для работы без подключения к БД

### Персистенция
- Автоматическое сохранение в `devices.json` при закрытии приложения
- Автоматическая загрузка при запуске
- Сохранение настроек вида (режим отображения, сортировка, группировка)

## Требования

- Windows 10/11 (x64)
- .NET 8.0 SDK (для сборки из исходников)

## Запуск из исходников

```bash
git clone <url>
cd EquipmentMonitor
dotnet run --project EquipmentMonitor
```

## Сборка exe

```bash
dotnet publish EquipmentMonitor/EquipmentMonitor.csproj -c Release
```

Результат: `EquipmentMonitor/bin/Release/net8.0-windows/win-x64/publish/EquipmentMonitor.exe`

Self-contained single-file — не требует установленного .NET на целевой машине.

## Тестовые данные

Файл `sample_devices.json` содержит 15 устройств (5 серверов, 6 ПК, 4 принтера) с разными статусами и датами для тестирования всей функциональности.

Для загрузки: Файл → Импорт → Из JSON → выбрать `sample_devices.json`.
